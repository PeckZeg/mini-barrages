"use strict";!function(a){"function"==typeof define&&define.amd?define("jquery.fn.miniBarrages",["jquery","lodash","moment"],a):a(jQuery,_,moment)}(function(a,b,c){function d(b,d,e){this.timeline=b,this.playTime=c.duration(d),this.text=e,this.$el=a("<p />",{"class":"mini-barrage"}).data("mini-barrage",this).text(this.text)}function e(e,f,g,h){var i=this;this.$el=a(e),f=c.duration(f),this.duration=+f?+f:+c.duration("00:01:00"),this.autoplay=b.get(h,"autoplay",!1),this.loop=b.get(h,"loop",0),this.barrages=b.chain(g).groupBy(function(a){return+c.duration(a.playTime)}).mapValues(function(a){return b.map(a,function(a){return new d(i,a.playTime,a.text)})}).value(),this.timeInterval=parseInt(b.get(h,"timeInterval")),this.timeInterval=isNaN(this.timeInterval)?200:this.timeInterval,this.autoplay&&this.play()}d.prototype.render=function(){this.$el.appendTo(this.timeline.$el);var a=this.timeline.$el.width(),c=this.timeline.$el.height(),d=Math.min(b.random(0,c),c-this.$el.height());return this.$el.width(this.$el.width()).css({top:d+"px",left:a+"px"}),this.$el},d.prototype.play=function(){this.$el.animate({left:"-"+this.$el.width()+"px"},this.timeline.duration,"linear")},e.prototype.play=function(a){var d=this;this._current=+c.duration(a),this._timer=b.delay(function(){if(d._current<=d.duration){var a=d._current+d.timeInterval;d.render(d._current,a<d.duration?a:d.duration),d._current=a,d.play(d._current)}else d._timer=null,d._current=0;0!=d.loop||d._timer||d.play()},this.timeInterval)},e.prototype.filter=function(a,c){return b.chain(this.barrages).filter(function(b,d){return d=parseInt(d),d>=a&&c>d}).flatten().value()},e.prototype.render=function(a,c){var d=this.filter(a,c);b.each(d,function(a){a.render(),a.play()})},a.fn.miniBarrages=function(c){var d=b.get(c,"duration"),f=b.get(c,"barrages");this.each(function(){var b=a(this).addClass("mini-barrages-canvas");b.data("mini-barrages",new e(this,d,f,c))})}});